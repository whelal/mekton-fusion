<form class="{{cssClass}} flexcol" autocomplete="off">
  <header class="sheet-header flexrow">
    <img class="profile" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
    <div class="header-fields">
      <h1><input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'MF.Name'}}"/></h1>
      
      <div class="header-stats flexrow">
        <div class="header-field">
          <label>ROLE</label>
          <input name="system.meta.role" type="text" value="{{system.meta.role}}" placeholder="rocker"/>
        </div>
        <div class="header-field">
          <label>AGE</label>
          <input name="system.meta.age" type="number" value="{{system.meta.age}}" placeholder="35"/>
        </div>
        <div class="header-field">
          <label>POINTS</label>
          <input name="system.meta.points" type="number" value="{{system.meta.points}}" placeholder="75"/>
        </div>
      </div>
    </div>
  </header>

  <nav class="sheet-tabs tabs">
    <a class="item" data-tab="stats">{{localize 'MF.TabStats'}}</a>
    <a class="item" data-tab="skills">{{localize 'MF.TabSkills'}}</a>
    <a class="item" data-tab="psi">{{localize 'MF.TabPsi'}}</a>
    <a class="item" data-tab="spells">{{localize 'MF.TabSpells'}}</a>
  </nav>

  <section class="sheet-body">
    <div class="tab stats" data-tab="stats">
      <div class="stats-container">
        <div class="stats-row flexrow">
          {{#each system.stats as |s key|}}
            <div class="stat-box" data-stat="{{key}}">
              <div class="stat-header">{{key}}</div>
              <div class="stat-value-row flexrow">
                <input name="system.stats.{{key}}.value" type="number" value="{{s.value}}" class="stat-input"/>
                <div class="stat-modifier">+ 0</div>
              </div>
              <div class="stat-total">{{s.value}}</div>
              <button type="button" class="stat-roll" data-ability="{{key}}" title="Roll {{key}}">
                <i class="fas fa-dice-d20"></i>
              </button>
            </div>
          {{/each}}
        </div>
      </div>
    </div>

    <div class="tab skills" data-tab="skills">
      <div class="skill-controls flexrow">
        <button type="button" class="skill-filter-fav-toggle" data-active="{{_skillViewStateSkills.favOnly}}">
          {{#if _skillViewStateSkills.favOnly}}
            {{localize 'MF.ShowAllSkills'}}
          {{else}}
            {{localize 'MF.ShowFavOnly'}}
          {{/if}}
        </button>
        <label>{{localize 'MF.SortBy'}}:
          <select class="skill-sort-by">
            <option value="name">{{localize 'MF.SortName'}}</option>
            <option value="stat">{{localize 'MF.SortStat'}}</option>
            <option value="rank">{{localize 'MF.SortRank'}}</option>
            <option value="total">{{localize 'MF.SortTotal'}}</option>
          </select>
        </label>
        <button type="button" class="skill-sort-dir" data-dir="{{_skillViewStateSkills.dir}}" title="Toggle direction">{{#if (eq _skillViewStateSkills.dir 'asc')}}▲{{else}}▼{{/if}}</button>
        {{#unless hasSkillItems}}
          <button type="button" class="seed-skills" title="Add Default Skills">Add Skills</button>
        {{/unless}}
      </div>
      {{#if hasSkillItems}}
        {{#each skillGroups as |group|}}
          <h3 class="skill-category-header">
            {{#if (eq group.category 'REF:COMBAT')}}Combat{{else}}{{#if (eq group.category 'REF:MECHA')}}Mecha{{else}}{{#if (eq group.category 'REF:UTILITY')}}Utility{{else}}{{localize (concat 'MF.SkillCat.' group.category) fallback=group.category}}{{/if}}{{/if}}{{/if}}
          </h3>
          <table class="skills-table">
            <thead>
              <tr>
                <th>{{localize 'MF.ColFav'}}</th>
                <th>{{localize 'MF.ColName'}}</th>
                <th>{{localize 'MF.ColStat'}}</th>
                <th>{{localize 'MF.ColRank'}}</th>
                <th>{{localize 'MF.ColTotal'}}</th>
                <th>{{localize 'MF.Roll'}}</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {{#each group.skills as |sk|}}
                <tr data-skill-id="{{sk.id}}" class="skill-item-row" data-favorite="{{sk.favorite}}" data-category="{{group.category}}">
                  <td class="skill-fav-cell"><a class="skill-fav" title="Toggle Favorite">{{#if sk.favorite}}★{{else}}☆{{/if}}</a></td>
                  <td class="skill-name">{{sk.name}} {{#if (and sk.hard (not sk.hasHardMarker))}}<span class="hard-flag" title="Hard Skill">(H)</span>{{/if}}</td>
                  <td class="skill-stat">{{sk.stat}}</td>
                  <td class="skill-rank-cell"><input class="skill-rank" type="number" min="0" value="{{sk.rank}}"/></td>
                  <td class="skill-total">{{sk.total}}</td>
                  <td class="skill-roll-cell"><button type="button" class="skill-roll" title="Roll {{sk.name}}"><i class="fas fa-dice-d20"></i></button></td>
                  <td class="skill-edit"><a class="item-control item-edit" title="{{localize 'MF.Edit'}}" data-item-id="{{sk.id}}"><i class="fas fa-edit"></i></a></td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        {{/each}}
      {{else}}
        <p class="mf-empty">{{localize 'MF.NoSkills'}}</p>
      {{/if}}
    </div>

    <div class="tab spells" data-tab="spells">
      {{#if hasSpells}}
        <div class="skill-controls flexrow spell-controls">
          <button type="button" class="skill-filter-fav-toggle" data-active="{{_skillViewStateSpells.favOnly}}">
            {{#if _skillViewStateSpells.favOnly}}
              {{localize 'MF.ShowAllSkills'}}
            {{else}}
              {{localize 'MF.ShowFavOnly'}}
            {{/if}}
          </button>
          <label>{{localize 'MF.SortBy'}}:
            <select class="skill-sort-by">
              <option value="name">{{localize 'MF.SortName'}}</option>
              <option value="stat">{{localize 'MF.SortStat'}}</option>
              <option value="rank">{{localize 'MF.SortRank'}}</option>
              <option value="total">{{localize 'MF.SortTotal'}}</option>
            </select>
          </label>
          <button type="button" class="skill-sort-dir" data-dir="{{_skillViewStateSpells.dir}}" title="Toggle direction">{{#if (eq _skillViewStateSpells.dir 'asc')}}▲{{else}}▼{{/if}}</button>
          <button type="button" class="spell-add-power" title="{{localize 'MF.AddSpell'}}">+</button>
        </div>
        <table class="skills-table spell-skills">
          <thead>
            <tr>
              <th>{{localize 'MF.ColFav'}}</th>
              <th>{{localize 'MF.ColName'}}</th>
              <th>{{localize 'MF.ColStat'}}</th>
              <th>{{localize 'MF.ColRank'}}</th>
              <th>{{localize 'MF.ColTotal'}}</th>
              <th>{{localize 'MF.School'}}</th>
              <th>{{localize 'MF.Cost'}}</th>
              <th>{{localize 'MF.Roll'}}</th>
              <th></th>
            </tr>
          </thead>
          <tbody class="sortable-spells">
            {{#each spells as |sp|}}
              <tr data-item-id="{{sp.id}}" class="spell-item-row {{#if sp.custom}}custom-spell{{/if}}" data-favorite="{{sp.favorite}}" draggable="true">
                <td class="spell-fav-cell"><a class="spell-fav" title="Toggle Favorite">{{#if sp.favorite}}★{{else}}☆{{/if}}</a></td>
                <td class="spell-name">
                  <span class="skill-drag-handle" title="Drag to reorder">⋮⋮</span>
                  {{sp.name}} 
                  {{#if sp.custom}}<span class="custom-flag" title="Custom Spell">✦</span>{{/if}}
                </td>
                <td class="spell-stat-cell">
                  <select class="spell-stat" data-item-id="{{sp.id}}">
                    <option value="INT" {{#if (eq sp.stat 'INT')}}selected{{/if}}>INT</option>
                    <option value="REF" {{#if (eq sp.stat 'REF')}}selected{{/if}}>REF</option>
                    <option value="TECH" {{#if (eq sp.stat 'TECH')}}selected{{/if}}>TECH</option>
                    <option value="COOL" {{#if (eq sp.stat 'COOL')}}selected{{/if}}>COOL</option>
                    <option value="ATTR" {{#if (eq sp.stat 'ATTR')}}selected{{/if}}>ATTR</option>
                    <option value="LUCK" {{#if (eq sp.stat 'LUCK')}}selected{{/if}}>LUCK</option>
                    <option value="MA" {{#if (eq sp.stat 'MA')}}selected{{/if}}>MA</option>
                    <option value="BODY" {{#if (eq sp.stat 'BODY')}}selected{{/if}}>BODY</option>
                    <option value="EMP" {{#if (eq sp.stat 'EMP')}}selected{{/if}}>EMP</option>
                    <option value="EDU" {{#if (eq sp.stat 'EDU')}}selected{{/if}}>EDU</option>
                    <option value="PSI" {{#if (eq sp.stat 'PSI')}}selected{{/if}}>PSI</option>
                  </select>
                </td>
                <td class="spell-rank-cell"><input class="spell-rank" type="number" min="0" value="{{sp.rank}}"/></td>
                <td class="spell-total">{{sp.total}}</td>
                <td class="spell-school">{{sp.school}}</td>
                <td class="spell-cost">{{sp.cost}}</td>
                <td class="spell-roll-cell"><button type="button" class="spell-roll" title="Cast {{sp.name}}"><i class="fas fa-magic"></i></button></td>
                <td class="spell-edit">
                  <a class="item-control item-edit" title="{{localize 'MF.Edit'}}" data-item-id="{{sp.id}}"><i class="fas fa-edit"></i></a>
                  {{#if sp.custom}}<a class="item-control spell-delete" title="{{localize 'MF.Delete'}}" data-item-id="{{sp.id}}"><i class="fas fa-trash"></i></a>{{/if}}
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      {{else}}
        <p class="mf-empty">{{localize 'MF.NoSpells'}}</p>
      {{/if}}
    </div>

    <div class="tab psi" data-tab="psi">
      {{#if hasPsiSkills}}
        <div class="skill-controls flexrow psi-controls">
          <button type="button" class="skill-filter-fav-toggle" data-active="{{_skillViewStatePsi.favOnly}}">
            {{#if _skillViewStatePsi.favOnly}}
              {{localize 'MF.ShowAllSkills'}}
            {{else}}
              {{localize 'MF.ShowFavOnly'}}
            {{/if}}
          </button>
          <label>{{localize 'MF.SortBy'}}:
            <select class="skill-sort-by">
              <option value="name">{{localize 'MF.SortName'}}</option>
              <option value="stat">{{localize 'MF.SortStat'}}</option>
              <option value="rank">{{localize 'MF.SortRank'}}</option>
              <option value="total">{{localize 'MF.SortTotal'}}</option>
            </select>
          </label>
          <button type="button" class="skill-sort-dir" data-dir="{{_skillViewStatePsi.dir}}" title="Toggle direction">{{#if (eq _skillViewStatePsi.dir 'asc')}}▲{{else}}▼{{/if}}</button>
            <button type="button" class="psi-add-power" title="{{localize 'MF.AddPsiPower'}}">+</button>
        </div>
        <table class="skills-table psi-skills">
          <thead>
            <tr>
              <th>{{localize 'MF.ColFav'}}</th>
              <th>{{localize 'MF.ColName'}}</th>
              <th>{{localize 'MF.ColStat'}}</th>
              <th>{{localize 'MF.ColRank'}}</th>
              <th>{{localize 'MF.ColTotal'}}</th>
              <th>{{localize 'MF.Roll'}}</th>
              <th></th>
            </tr>
          </thead>
          <tbody class="sortable-skills">
            {{#each psiSkills as |sk|}}
              <tr data-skill-id="{{sk.id}}" class="skill-item-row {{#if sk.custom}}custom-skill{{/if}}" data-favorite="{{sk.favorite}}" data-category="PSI" draggable="true">
                <td class="skill-fav-cell"><a class="skill-fav" title="Toggle Favorite">{{#if sk.favorite}}★{{else}}☆{{/if}}</a></td>
                <td class="skill-name">
                  <span class="skill-drag-handle" title="Drag to reorder">⋮⋮</span>
                  {{sk.name}} 
                  {{#if sk.custom}}<span class="custom-flag" title="Custom/Homebrew Power">✦</span>{{/if}}
                  {{#if (and sk.hard (not sk.hasHardMarker))}}<span class="hard-flag" title="Hard Skill">(H)</span>{{/if}}
                </td>
                <td class="skill-stat">{{sk.stat}}</td>
                <td class="skill-rank-cell"><input class="skill-rank" type="number" min="0" value="{{sk.rank}}"/></td>
                <td class="skill-total">{{sk.total}}</td>
                <td class="skill-roll-cell"><button type="button" class="skill-roll" title="Roll {{sk.name}}"><i class="fas fa-dice-d20"></i></button></td>
                <td class="skill-edit">
                  <a class="item-control item-edit" title="{{localize 'MF.Edit'}}" data-item-id="{{sk.id}}"><i class="fas fa-edit"></i></a>
                  {{#if sk.custom}}<a class="item-control item-delete" title="{{localize 'MF.Delete'}}" data-item-id="{{sk.id}}"><i class="fas fa-trash"></i></a>{{/if}}
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      {{else}}
        <p class="mf-empty">{{localize 'MF.NoPsiSkills'}}</p>
      {{/if}}
    </div>
  </section>
</form>
