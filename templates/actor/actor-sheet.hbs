<form class="{{cssClass}} flexcol" autocomplete="off">
  <header class="sheet-header flexrow">
    <img class="profile" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" alt="{{actor.name}}" />
    <div class="header-fields">
      <h1><input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'MF.Name'}}"/></h1>
      
      <div class="header-stats flexrow">
        <div class="header-field">
          <label>ROLE</label>
          <input name="system.meta.role" type="text" value="{{system.meta.role}}" placeholder="rocker"/>
        </div>
        <div class="header-field">
          <label>AGE</label>
          <input name="system.meta.age" type="number" value="{{system.meta.age}}" placeholder="35"/>
        </div>
        <div class="header-field">
          <label>POINTS</label>
          <input name="system.meta.points" type="number" value="{{system.meta.points}}" placeholder="75"/>
        </div>
      </div>
    </div>
    <!-- header content only (substats moved into Stats tab) -->
    <!-- Homebrew notice removed from header; see HOMEBREW_NOTICE.md in system folder -->
  </header>

  <nav class="sheet-tabs tabs">
    <a class="item" data-tab="stats">{{localize 'MF.TabStats'}}</a>
    <a class="item" data-tab="skills">{{localize 'MF.TabSkills'}}</a>
    <a class="item" data-tab="psi">{{localize 'MF.TabPsi'}}</a>
    <a class="item" data-tab="spells">{{localize 'MF.TabSpells'}}</a>
    <a class="item" data-tab="equipment">{{localize 'MF.TabEquipment' 'Equipment'}}</a>
    <a class="item" data-tab="notes">{{localize 'MF.TabNotes' 'Notes'}}</a>
  </nav>

  <section class="sheet-body">
    <div class="tab stats" data-tab="stats">
      <div class="stats-container">
        <!-- Stats grid: Row 1 (6 stats), Row 2 (5 stats) -->
        <div class="stats-grid-top">
          <div class="stat-row-top row-six">
            {{!-- Row 1: INT REF TECH COOL ATTR LUCK --}}
            <div class="stat-box" data-stat="INT">
              <div class="stat-header">INT</div>
              <div class="stat-inline">
                <input name="system.stats.INT.value" type="number" value="{{system.stats.INT.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="INT" title="Roll INT" aria-label="Roll INT"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="REF">
              <div class="stat-header">REF</div>
              <div class="stat-inline">
                <input name="system.stats.REF.value" type="number" value="{{system.stats.REF.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="REF" title="Roll REF" aria-label="Roll REF"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="TECH">
              <div class="stat-header">TECH</div>
              <div class="stat-inline">
                <input name="system.stats.TECH.value" type="number" value="{{system.stats.TECH.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="TECH" title="Roll TECH" aria-label="Roll TECH"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="COOL">
              <div class="stat-header">COOL</div>
              <div class="stat-inline">
                <input name="system.stats.COOL.value" type="number" value="{{system.stats.COOL.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="COOL" title="Roll COOL" aria-label="Roll COOL"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="ATTR">
              <div class="stat-header">ATTR</div>
              <div class="stat-inline">
                <input name="system.stats.ATTR.value" type="number" value="{{system.stats.ATTR.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="ATTR" title="Roll ATTR" aria-label="Roll ATTR"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="LUCK">
              <div class="stat-header">LUCK</div>
              <div class="stat-inline">
                <input name="system.stats.LUCK.value" type="number" value="{{system.stats.LUCK.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="LUCK" title="Roll LUCK" aria-label="Roll LUCK"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
          </div>
          <div class="stat-row-top row-five">
            {{!-- Row 2: MA BODY EMP EDU PSI --}}
            <div class="stat-box" data-stat="MA">
              <div class="stat-header">MA</div>
              <div class="stat-inline">
                <input name="system.stats.MA.value" type="number" value="{{system.stats.MA.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="MA" title="Roll MA" aria-label="Roll MA"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="BODY">
              <div class="stat-header">BODY</div>
              <div class="stat-inline">
                <input name="system.stats.BODY.value" type="number" value="{{system.stats.BODY.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="BODY" title="Roll BODY" aria-label="Roll BODY"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="EMP">
              <div class="stat-header">EMP</div>
              <div class="stat-inline">
                <input name="system.stats.EMP.value" type="number" value="{{system.stats.EMP.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="EMP" title="Roll EMP" aria-label="Roll EMP"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="EDU">
              <div class="stat-header">EDU</div>
              <div class="stat-inline">
                <input name="system.stats.EDU.value" type="number" value="{{system.stats.EDU.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="EDU" title="Roll EDU" aria-label="Roll EDU"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
            <div class="stat-box" data-stat="PSI">
              <div class="stat-header">PSI</div>
              <div class="stat-inline">
                <input name="system.stats.PSI.value" type="number" value="{{system.stats.PSI.value}}" class="stat-input"/>
                <button type="button" class="stat-roll" data-ability="PSI" title="Roll PSI" aria-label="Roll PSI"><i class="fas fa-dice-d20"></i></button>
              </div>
            </div>
          </div>
        </div>

        <!-- Two-column body/ref panels -->
        <div class="stats-two-col">
          <div class="panel panel-left">
            <h4>BODY</h4>
            <div class="panel-list">
              <label>• Stun Save: <input class="substat-input" name="system.substats.stun" type="number" min="0" value="{{system.substats.stun}}"/></label>
              <label>• Death Save: <input class="substat-input" name="system.substats.death" type="number" min="0" value="{{system.substats.death}}"/></label>
              <label>• Lift: <input class="substat-input" name="system.substats.lift" type="number" min="0" value="{{system.substats.lift}}"/></label>
              <label>• Carry: <input class="substat-input" name="system.substats.carry" type="number" min="0" value="{{system.substats.carry}}"/></label>
            </div>
            <div class="panel-emp">
              <h5>EMP</h5>
              <label>• Humanity: <input class="substat-input" name="system.substats.humanity" type="number" min="0" value="{{system.substats.humanity}}"/></label>
            </div>
          </div>

          <div class="panel panel-right">
            <h4>MA</h4>
            <div class="panel-list">
              <label>• Run: <input class="substat-input" name="system.substats.run" type="number" min="0" value="{{system.substats.run}}"/></label>
              <label>• Leap: <input class="substat-input" name="system.substats.leap" type="number" min="0" value="{{system.substats.leap}}"/></label>
              <label>• Swim: <input class="substat-input" name="system.substats.swim" type="number" min="0" value="{{system.substats.swim}}"/></label>
            </div>
            <div class="panel-initiative">
              <h5>REF</h5>
              <label>• {{localize 'MF.InitiativeMod'}}: <input class="substat-input" name="system.substats.initiative" type="number" value="{{system.substats.initiative}}" title="{{localize 'MF.InitiativeModTooltip'}}"/></label>
            </div>
          </div>
        </div>

        <!-- Resource bars -->
        <div class="resource-bars">
          <div class="resource-row">
            <label class="resource-label">HP:</label>
            <div class="resource-bar" data-resource="hp">
              <div class="resource-fill" style="width: {{resources.hp.percent}}%"></div>
              <div class="resource-values" aria-live="polite">{{resources.hp.current}} / {{resources.hp.max}}</div>
            </div>
            <label class="visually-hidden" for="hp-current-input">Current</label>
            <input id="hp-current-input" class="resource-input" name="system.substats.hp_current" type="number" min="0" value="{{resources.hp.current}}"/>
            <label class="visually-hidden" for="hp-max-input">Max</label>
            <input id="hp-max-input" class="resource-input" name="system.substats.hp" type="number" min="0" value="{{resources.hp.max}}"/>
          </div>
          <div class="resource-row">
            <label class="resource-label">Stamina:</label>
            <div class="resource-bar" data-resource="stamina">
              <div class="resource-fill" style="width: {{resources.stamina.percent}}%"></div>
              <div class="resource-values" aria-live="polite">{{resources.stamina.current}} / {{resources.stamina.max}}</div>
            </div>
            <label class="visually-hidden" for="sta-current-input">Current</label>
            <input id="sta-current-input" class="resource-input" name="system.substats.sta_current" type="number" min="0" value="{{resources.stamina.current}}"/>
            <label class="visually-hidden" for="sta-max-input">Max</label>
            <input id="sta-max-input" class="resource-input" name="system.substats.sta" type="number" min="0" value="{{resources.stamina.max}}"/>
          </div>
          <div class="resource-row">
            <label class="resource-label">Vigor:</label>
            <div class="resource-bar" data-resource="vigor">
              <div class="resource-fill" style="width: {{resources.vigor.percent}}%"></div>
              <div class="resource-values" aria-live="polite">{{resources.vigor.current}} / {{resources.vigor.max}}</div>
            </div>
            <label class="visually-hidden" for="vigor-current-input">Current</label>
            <input id="vigor-current-input" class="resource-input" name="system.substats.rec_current" type="number" min="0" value="{{resources.vigor.current}}"/>
            <label class="visually-hidden" for="vigor-max-input">Max</label>
            <input id="vigor-max-input" class="resource-input" name="system.substats.rec" type="number" min="0" value="{{resources.vigor.max}}"/>
          </div>
          <div class="resource-row">
            <label class="resource-label">Psi Points:</label>
            <div class="resource-bar" data-resource="psihybrid">
              <div class="resource-fill" style="width: {{resources.psihybrid.percent}}%"></div>
              <div class="resource-values" aria-live="polite">{{resources.psihybrid.current}} / {{resources.psihybrid.max}}</div>
            </div>
            <label class="visually-hidden" for="psihybrid-current-input">Current</label>
            <input id="psihybrid-current-input" class="resource-input" name="system.substats.psihybrid_current" type="number" min="0" value="{{resources.psihybrid.current}}"/>
            <label class="visually-hidden" for="psihybrid-max-input">Max</label>
            <input id="psihybrid-max-input" class="resource-input" name="system.substats.psihybrid" type="number" min="0" value="{{resources.psihybrid.max}}"/>
          </div>
        </div>
      </div>
    </div>

    <div class="tab skills" data-tab="skills">
      <div class="skill-controls flexrow">
            <button type="button" class="skill-filter-fav-toggle" data-active="{{_skillViewStateSkills.favOnly}}">
              {{#if _skillViewStateSkills.favOnly}}
                {{localize 'MF.ShowAllSkills'}}
              {{else}}
                {{localize 'MF.ShowFavOnly'}}
              {{/if}}
            </button>
            <label>{{localize 'MF.SortBy'}}:
              <select class="skill-sort-by">
                <option value="name" {{#if (eq _skillViewStateSkills.sortBy 'name')}}selected{{/if}}>{{localize 'MF.SortName'}}</option>
                <option value="stat" {{#if (eq _skillViewStateSkills.sortBy 'stat')}}selected{{/if}}>{{localize 'MF.SortStat'}}</option>
                <option value="rank" {{#if (eq _skillViewStateSkills.sortBy 'rank')}}selected{{/if}}>{{localize 'MF.SortRank'}}</option>
                <option value="total" {{#if (eq _skillViewStateSkills.sortBy 'total')}}selected{{/if}}>{{localize 'MF.SortTotal'}}</option>
              </select>
            </label>
            <button type="button" class="skill-sort-dir" data-dir="{{_skillViewStateSkills.dir}}" title="Toggle direction">{{#if (eq _skillViewStateSkills.dir 'asc')}}▲{{else}}▼{{/if}}</button>
            <button type="button" class="custom-skill-add custom-skill-add-top" title="{{localize 'MF.AddCustomSkill'}}">+</button>
        {{#unless hasSkillItems}}
          <div class="skill-menu" style="display:inline-block;position:relative;">
            <button type="button" class="skill-menu-kebab" title="More actions" aria-label="More actions" style="background:none;border:none;padding:0 6px;"><i class="fas fa-ellipsis-v"></i></button>
            <div class="skill-menu-dropdown" style="display:none;position:absolute;right:0;z-index:10;background:#222;padding:4px 0;border-radius:4px;box-shadow:0 2px 8px #0008;">
              <button type="button" class="seed-skills" title="Add Default Skills" aria-label="Seed Default Skills" style="width:100%;text-align:left;padding:4px 16px;background:none;border:none;color:#fff;">Seed Skills</button>
            </div>
          </div>
        {{/unless}}
      </div>
      {{#if hasSkillItems}}
        <div class="skills-table-wrapper" aria-label="All Skills" role="region">
        <table class="skills-table all-skills" role="table">
          <colgroup>
            <col /> <!-- Fav -->
            <col /> <!-- Name -->
            <col /> <!-- Stat -->
            <col /> <!-- Rank -->
            <col /> <!-- IP -->
            <col /> <!-- Total -->
            <col /> <!-- Roll -->
            <col /> <!-- Edit -->
          </colgroup>
          <thead>
            <tr>
              <th scope="col">{{localize 'MF.ColFav'}}</th>
              <th scope="col">{{localize 'MF.ColName'}}</th>
              <th scope="col">{{localize 'MF.ColStat'}}</th>
              <th scope="col">{{localize 'MF.ColRank'}}</th>
              <th scope="col" class="col-ip">{{localize 'MF.ColIP'}}</th>
              <th scope="col" class="col-total">{{localize 'MF.ColTotal'}}</th>
              <th scope="col">{{localize 'MF.Roll'}}</th>
              <th scope="col" aria-label="Actions"></th>
            </tr>
          </thead>
          <tbody>
            {{#each skillGroups as |group|}}
              <tr class="skill-category-row" data-category="{{group.category}}">
                <th colspan="8" class="skill-category-divider" scope="colgroup">
                  {{#if (eq group.category 'REF:COMBAT')}}Combat{{else}}{{#if (eq group.category 'REF:MECHA')}}Mecha{{else}}{{#if (eq group.category 'REF:UTILITY')}}Utility{{else}}{{localize (concat 'MF.SkillCat.' group.category) fallback=group.category}}{{/if}}{{/if}}{{/if}}
                </th>
              </tr>
              {{#each group.skills as |sk|}}
                <tr data-skill-id="{{sk.id}}" class="skill-item-row" data-favorite="{{sk.favorite}}" data-category="{{group.category}}" role="row">
                  <td class="skill-fav-cell"><a class="skill-fav" title="Toggle Favorite">{{#if sk.favorite}}★{{else}}☆{{/if}}</a></td>
                  <td class="skill-name">
                    {{sk.name}} {{#if (and sk.hard (not sk.hasHardMarker))}}<span class="hard-flag" title="Hard Skill">(H)</span>{{/if}}
                  </td>
                  <td class="skill-stat">{{sk.stat}}</td>
                  <td class="skill-rank-cell"><input class="skill-rank" type="number" min="0" max="50" step="1" value="{{sk.rank}}"/></td>
                  <td class="skill-ip-cell"><input class="skill-ip short-input" type="number" min="0" max="999" step="1" value="{{sk.system.ip}}" title="{{localize 'MF.IPTooltip'}}"/></td>
                  <td class="skill-total">{{sk.total}}</td>
                  <td class="skill-roll-cell"><button type="button" class="skill-roll" title="Roll {{sk.name}}"><i class="fas fa-dice-d20"></i></button></td>
                  <td class="skill-edit"><a class="item-control item-edit" title="{{localize 'MF.Edit'}}" data-item-id="{{sk.id}}"><i class="fas fa-edit"></i></a></td>
                </tr>
              {{/each}}
            {{/each}}
            {{!-- Custom Skills Section (gather skills with system.custom true & not PSI) --}}
            {{#if customSkills.length}}
            <tr class="skill-category-row" data-category="CUSTOM">
              <th colspan="8" class="skill-category-divider" scope="colgroup">{{localize 'MF.CustomSkillsCategory'}}
                <button type="button" class="custom-skill-add" title="{{localize 'MF.AddCustomSkill'}}">+</button>
              </th>
            </tr>
            {{#each customSkills as |sk|}}
              <tr data-skill-id="{{sk.id}}" class="skill-item-row" data-favorite="{{sk.favorite}}" data-category="CUSTOM" role="row">
                <td class="skill-fav-cell"><a class="skill-fav" title="Toggle Favorite">{{#if sk.favorite}}★{{else}}☆{{/if}}</a></td>
                <td class="skill-name">{{sk.name}} {{#if (and sk.hard (not sk.hasHardMarker))}}<span class="hard-flag" title="Hard Skill">(H)</span>{{/if}}</td>
                <td class="skill-stat">{{sk.stat}}</td>
                <td class="skill-rank-cell"><input class="skill-rank" type="number" min="0" max="50" step="1" value="{{sk.rank}}"/></td>
                <td class="skill-ip-cell"><input class="skill-ip short-input" type="number" min="0" max="999" step="1" value="{{sk.system.ip}}" title="{{localize 'MF.IPTooltip'}}"/></td>
                <td class="skill-total">{{sk.total}}</td>
                <td class="skill-roll-cell"><button type="button" class="skill-roll" title="Roll {{sk.name}}"><i class="fas fa-dice-d20"></i></button></td>
                <td class="skill-edit">
                  <a class="item-control item-edit" title="{{localize 'MF.Edit'}}" data-item-id="{{sk.id}}"><i class="fas fa-edit"></i></a>
                  <a class="item-control custom-skill-delete" title="{{localize 'MF.Delete'}}" data-item-id="{{sk.id}}"><i class="fas fa-trash"></i></a>
                </td>
              </tr>
            {{/each}}
            {{else}}
            <tr class="skill-category-row" data-category="CUSTOM">
              <th colspan="8" class="skill-category-divider" scope="colgroup">{{localize 'MF.CustomSkillsCategory'}}
                <button type="button" class="custom-skill-add" title="{{localize 'MF.AddCustomSkill'}}">+</button>
              </th>
            </tr>
            {{/if}}
          </tbody>
        </table>
        </div>
      {{else}}
        <p class="mf-empty">{{localize 'MF.NoSkills'}}</p>
      {{/if}}
    </div>

    <div class="tab spells" data-tab="spells">
      {{#if hasAnySpells}}
        <div class="skill-controls flexrow spell-controls">
          <button type="button" class="skill-filter-fav-toggle" data-active="{{_skillViewStateSpells.favOnly}}">
            {{#if _skillViewStateSpells.favOnly}}
              {{localize 'MF.ShowAllSkills'}}
            {{else}}
              {{localize 'MF.ShowFavOnly'}}
            {{/if}}
          </button>
          <label>{{localize 'MF.SortBy'}}:
            <select class="skill-sort-by">
              <option value="name" {{#if (eq _skillViewStateSpells.sortBy 'name')}}selected{{/if}}>{{localize 'MF.SortName'}}</option>
              <option value="stat" {{#if (eq _skillViewStateSpells.sortBy 'stat')}}selected{{/if}}>{{localize 'MF.SortStat'}}</option>
              <option value="rank" {{#if (eq _skillViewStateSpells.sortBy 'rank')}}selected{{/if}}>{{localize 'MF.SortRank'}}</option>
              <option value="total" {{#if (eq _skillViewStateSpells.sortBy 'total')}}selected{{/if}}>{{localize 'MF.SortTotal'}}</option>
            </select>
          </label>
          <button type="button" class="skill-sort-dir" data-dir="{{_skillViewStateSpells.dir}}" title="Toggle direction">{{#if (eq _skillViewStateSpells.dir 'asc')}}▲{{else}}▼{{/if}}</button>
          <button type="button" class="spell-add-power" title="{{localize 'MF.AddSpell'}}">+</button>
        </div>
        {{#if hasSpells}}
        <table class="skills-table spell-skills">
          <thead>
            <tr>
              <th>{{localize 'MF.ColFav'}}</th>
              <th>{{localize 'MF.ColName'}}</th>
              <th>{{localize 'MF.Cost'}}</th>
              <th>{{localize 'MF.Range'}}</th>
              <th>{{localize 'MF.Duration'}}</th>
              <th>{{localize 'MF.Defense'}}</th>
              <th>{{localize 'MF.Roll'}}</th>
              <th></th>
            </tr>
          </thead>
          <tbody class="sortable-spells">
            {{#each spells as |sp|}}
              <tr data-item-id="{{sp.id}}" class="spell-item-row {{#if sp.custom}}custom-spell{{/if}}" data-favorite="{{sp.favorite}}" draggable="true">
                <td class="spell-fav-cell"><a class="spell-fav" title="Toggle Favorite">{{#if sp.favorite}}★{{else}}☆{{/if}}</a></td>
                <td class="spell-name">
                  <span class="skill-drag-handle" title="Drag to reorder">⋮⋮</span>
                  {{sp.name}} 
                  {{#if sp.custom}}<span class="custom-flag" title="Custom Spell">✦</span>{{/if}}
                </td>
                <td class="spell-cost-cell"><input class="spell-cost short-input" type="number" min="0" max="99" step="1" value="{{sp.cost}}" data-item-id="{{sp.id}}"/></td>
                <td class="spell-range-cell"><input class="spell-range" type="text" value="{{sp.range}}" placeholder="m/self" data-item-id="{{sp.id}}"/></td>
                <td class="spell-duration-cell"><input class="spell-duration" type="text" value="{{sp.duration}}" placeholder="rounds/instant" data-item-id="{{sp.id}}"/></td>
                <td class="spell-defense-cell"><input class="spell-defense" type="text" value="{{sp.defense}}" placeholder="dodge/block" data-item-id="{{sp.id}}"/></td>
                <td class="spell-roll-cell"><button type="button" class="spell-roll" title="Cast {{sp.name}}"><i class="fas fa-magic"></i></button></td>
                <td class="spell-edit">
                  <a class="item-control item-edit" title="{{localize 'MF.Edit'}}" data-item-id="{{sp.id}}"><i class="fas fa-edit"></i></a>
                  {{#if sp.custom}}<a class="item-control spell-delete" title="{{localize 'MF.Delete'}}" data-item-id="{{sp.id}}"><i class="fas fa-trash"></i></a>{{/if}}
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
        {{else}}
          {{#if spells.length}}
            {{#unless spells.[0].spellcasting}}
              <tr><td colspan="8" class="mf-warning">{{localize 'MF.SpellcastingMissing'}}</td></tr>
            {{/unless}}
          {{else}}
            <p class="mf-empty">{{#if _skillViewStateSpells.favOnly}}{{localize 'MF.NoFavoriteSpells'}}{{else}}{{localize 'MF.NoSpells'}}{{/if}}</p>
          {{/if}}
        {{/if}}
      {{else}}
        <p class="mf-empty">{{localize 'MF.NoSpells'}}</p>
      {{/if}}
    </div>

  <div class="tab psi" data-tab="psi">
      {{#if hasAnyPsiSkills}}
        <div class="skill-controls flexrow psi-controls">
          <button type="button" class="skill-filter-fav-toggle" data-active="{{_skillViewStatePsi.favOnly}}">
            {{#if _skillViewStatePsi.favOnly}}
              {{localize 'MF.ShowAllSkills'}}
            {{else}}
              {{localize 'MF.ShowFavOnly'}}
            {{/if}}
          </button>
          <label>{{localize 'MF.SortBy'}}:
            <select class="skill-sort-by">
              <option value="name" {{#if (eq _skillViewStatePsi.sortBy 'name')}}selected{{/if}}>{{localize 'MF.SortName'}}</option>
              <option value="stat" {{#if (eq _skillViewStatePsi.sortBy 'stat')}}selected{{/if}}>{{localize 'MF.SortStat'}}</option>
              <option value="rank" {{#if (eq _skillViewStatePsi.sortBy 'rank')}}selected{{/if}}>{{localize 'MF.SortRank'}}</option>
              <option value="total" {{#if (eq _skillViewStatePsi.sortBy 'total')}}selected{{/if}}>{{localize 'MF.SortTotal'}}</option>
            </select>
          </label>
          <button type="button" class="skill-sort-dir" data-dir="{{_skillViewStatePsi.dir}}" title="Toggle direction">{{#if (eq _skillViewStatePsi.dir 'asc')}}▲{{else}}▼{{/if}}</button>
            <button type="button" class="psi-add-power" title="{{localize 'MF.AddPsiPower'}}">+</button>
        </div>
        {{#if hasPsiSkills}}
        <table class="skills-table psi-skills">
          <colgroup>
            <col /> <!-- Fav -->
            <col /> <!-- Name -->
            <col /> <!-- Stat -->
            <col /> <!-- Rank -->
            <col /> <!-- IP -->
            <col /> <!-- Total -->
            <col /> <!-- Roll -->
            <col /> <!-- Edit -->
          </colgroup>
          <thead>
            <tr>
              <th>{{localize 'MF.ColFav'}}</th>
              <th>{{localize 'MF.ColName'}}</th>
              <th>{{localize 'MF.ColStat'}}</th>
              <th>{{localize 'MF.ColRank'}}</th>
              <th>{{localize 'MF.ColIP'}}</th>
              <th>{{localize 'MF.ColTotal'}}</th>
              <th>{{localize 'MF.Roll'}}</th>
              <th></th>
            </tr>
          </thead>
          <tbody class="sortable-skills">
            {{#each psiSkills as |sk|}}
              <tr data-skill-id="{{sk.id}}" class="skill-item-row {{#if sk.custom}}custom-skill{{/if}}" data-favorite="{{sk.favorite}}" data-category="PSI" draggable="true">
                <td class="skill-fav-cell"><a class="skill-fav" title="Toggle Favorite">{{#if sk.favorite}}★{{else}}☆{{/if}}</a></td>
                <td class="skill-name">
                  <span class="skill-drag-handle" title="Drag to reorder">⋮⋮</span>
                  {{sk.name}} 
                  {{#if sk.custom}}<span class="custom-flag" title="Custom/Homebrew Power">✦</span>{{/if}}
                  {{#if (and sk.hard (not sk.hasHardMarker))}}<span class="hard-flag" title="Hard Skill">(H)</span>{{/if}}
                </td>
                <td class="skill-stat">{{sk.stat}}</td>
                <td class="skill-rank-cell"><input class="skill-rank short-input" type="number" min="0" max="50" step="1" value="{{sk.rank}}"/></td>
                <td class="skill-ip-cell"><input class="skill-ip short-input" type="number" min="0" max="999" step="1" value="{{sk.system.ip}}" title="{{localize 'MF.IPTooltip'}}"/></td>
                <td class="skill-total">{{sk.total}}</td>
                <td class="skill-roll-cell"><button type="button" class="skill-roll" title="Roll {{sk.name}}"><i class="fas fa-dice-d20"></i></button></td>
                <td class="skill-edit">
                  <a class="item-control item-edit" title="{{localize 'MF.Edit'}}" data-item-id="{{sk.id}}"><i class="fas fa-edit"></i></a>
                  {{#if sk.custom}}<a class="item-control psi-delete" title="{{localize 'MF.Delete'}}" data-item-id="{{sk.id}}"><i class="fas fa-trash"></i></a>{{/if}}
                </td>
              </tr>
            {{/each}}
          </tbody>

        </table>
      {{else}}
        <p class="mf-empty">{{localize 'MF.NoPsiSkills'}}</p>
      {{/if}}
    {{else}}
      <p class="mf-empty">{{localize 'MF.NoPsiCategory'}}</p>
    {{/if}}

</div>
<div class="tab equipment" data-tab="equipment">
  <div class="equipment-container">
    <div class="equipment-header">
      <label for="equipment-weight-input" class="weight-label">{{localize 'MF.TotalWeight' 'Total Weight'}}</label>
      <input id="equipment-weight-input" name="system.equipment.totalWeight" type="number" class="weight-input" min="0" step="0.1" value="{{system.equipment.totalWeight}}" placeholder="0"/>
    </div>
    <label for="equipment-gear-textarea" class="gear-label">{{localize 'MF.GearLog' 'Gear Log'}}</label>
    <textarea id="equipment-gear-textarea" name="system.equipment.gear" class="gear-textarea" rows="15" placeholder="List your equipment here...">{{system.equipment.gear}}</textarea>
  </div>
</div>
<div class="tab notes" data-tab="notes">
  <div class="notes-container">
    <label for="actor-notes-textarea" class="notes-label">{{localize 'MF.NotesLabel' 'Notes'}}</label>
    <textarea id="actor-notes-textarea" name="system.notes" class="notes-textarea" rows="12" placeholder="Enter any extra info here...">{{system.notes}}</textarea>
  </div>
</div>
</section>
</form>
